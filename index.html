<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì²´ìœ¡ëŒ€íšŒ ì‘ì „íŒ</title>
<style>
  body {
    font-family: 'Pretendard', sans-serif, sans-serif;
    background: #f0f2f5;
    margin: 0; padding: 20px;
  }
  h1 {
    color: #2c3e50;
    margin-bottom: 30px;
  }
  .board {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .column {
    background: white;
    border-radius: 12px;
    padding: 20px;
    width: 100%;
    max-width: 600px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  }
  .column h2 {
    margin-top: 0;
  }
  .add-form {
    margin-top: 10px;
  }
  select, textarea, button {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
  }
  button {
    background: #2ecc71;
    color: white;
    border: none;
    cursor: pointer;
    user-select: none;
  }
  button:hover {
    background: #27ae60;
  }
  #diagram-container {
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #fff;
    position: relative;
    width: 100%;
    height: 400px;
    user-select: none;
  }
  svg {
    width: 100%;
    height: 100%;
    display: block;
  }
  .name-input {
    position: absolute;
    background: rgba(255,255,255,0.95);
    border: 1px solid #888;
    border-radius: 4px;
    padding: 2px 6px;
    font-size: 14px;
    transform: translate(-50%, -50%);
    z-index: 20;
    min-width: 80px;
    box-sizing: border-box;
  }
  .name-label {
    position: absolute;
    background: rgba(46, 204, 113, 0.85);
    color: white;
    padding: 2px 8px;
    font-size: 14px;
    border-radius: 12px;
    white-space: nowrap;
    cursor: pointer; /* í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ì»¤ì„œ ë³€ê²½ */
    transform: translate(-50%, -50%);
    z-index: 15;
  }
  .item {
    background: #ecf0f1;
    border-radius: 8px;
    padding: 10px 40px 10px 10px;
    margin-top: 10px;
    position: relative;
    user-select: none;
  }
  .delete-btn {
    position: absolute;
    top: 50%;
    right: 8px;
    transform: translateY(-50%);
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    padding: 1px 6px;
    font-size: 12px;
    line-height: 1;
    user-select: none;
    transition: background-color 0.2s ease;
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .delete-btn:hover {
    background: #c0392b;
  }
</style>
</head>
<body>

<h1>ğŸ… 2-5ì²´ìœ¡ëŒ€íšŒ ì‘ì „íŒ</h1>
<div class="board">
  <div class="column">
    <h2>ğŸ‘†ğŸ¿ ì¢…ëª©ë³„ ì‘ì „</h2>
    <div id="strategy-list"></div>
    <div class="add-form">
      <select id="strategy-title">
        <option value="ë†êµ¬">ë†êµ¬</option>
        <option value="ë°°êµ¬">ë°°êµ¬</option>
        <option value="í‚¨ë³¼">í‚¨ë³¼</option>
        <option value="ì¶•êµ¬">ì¶•êµ¬</option>
      </select>
      <textarea id="strategy-content" placeholder="ì‘ì „ ë‚´ìš©"></textarea>
      <button id="strategy-add-btn">â• ì¶”ê°€</button>
    </div>
  </div>

  <div class="column">
    <h2>ğŸ¤“ ì„ ìˆ˜ ë°°ì¹˜</h2>
    <div id="player-list"></div>
    <div class="add-form">
      <select id="sport-select">
        <option value="ë†êµ¬">ë†êµ¬</option>
        <option value="ë°°êµ¬">ë°°êµ¬</option>
        <option value="í‚¨ë³¼">í‚¨ë³¼</option>
        <option value="ì¶•êµ¬">ì¶•êµ¬</option>
      </select>

      <div id="diagram-container"></div>

      <button id="player-save-btn">â• ì €ì¥</button>
    </div>
  </div>
</div>

<script>
  const STORAGE_STRATEGY = 'strategyList';
  const STORAGE_PLAYER = 'playerList';

  let currentSport = 'ë†êµ¬';
  let svg;
  let playerPositions = []; // {name, x, y}
  let currentInput = null;
  let editingIndex = null; // ìˆ˜ì • ì¤‘ì¸ playerPositions ì¸ë±ìŠ¤

  window.onload = () => {
    loadStrategies();
    loadPlayers();
    setupEventListeners();
    changeDiagram();
  };

  function setupEventListeners() {
    document.getElementById('strategy-add-btn').addEventListener('click', () => {
      addItem('strategy');
    });
    document.getElementById('player-save-btn').addEventListener('click', () => {
      savePlayers();
    });
    document.getElementById('sport-select').addEventListener('change', () => {
      currentSport = document.getElementById('sport-select').value;
      clearInputs();
      loadPlayers();
      changeDiagram();
    });
  }

  // ì¢…ëª©ë³„ ì‘ì „ ì¶”ê°€
  function addItem(type) {
    if (type === 'strategy') {
      const title = document.getElementById('strategy-title').value;
      const content = document.getElementById('strategy-content').value.trim();
      if (!content) return alert('ì‘ì „ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      const list = JSON.parse(localStorage.getItem(STORAGE_STRATEGY)) || [];
      list.push({ title, content });
      localStorage.setItem(STORAGE_STRATEGY, JSON.stringify(list));
      document.getElementById('strategy-content').value = '';
      loadStrategies();
    }
  }

  // ì¢…ëª©ë³„ ì‘ì „ ë¶ˆëŸ¬ì˜¤ê¸°
  function loadStrategies() {
    const container = document.getElementById('strategy-list');
    container.innerHTML = '';
    const list = JSON.parse(localStorage.getItem(STORAGE_STRATEGY)) || [];
    list.forEach((item, i) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<strong>${item.title}</strong><br>${item.content}`;
      const btn = document.createElement('button');
      btn.className = 'delete-btn';
      btn.innerText = 'Ã—';
      btn.title = 'ì‚­ì œ';
      btn.onclick = () => {
        list.splice(i, 1);
        localStorage.setItem(STORAGE_STRATEGY, JSON.stringify(list));
        loadStrategies();
      };
      div.appendChild(btn);
      container.appendChild(div);
    });
  }

  // ì„ ìˆ˜ ì €ì¥
  function savePlayers() {
    if (playerPositions.length === 0) {
      alert('ë°°ì¹˜ë„ ìœ„ì— ì´ë¦„ì„ ë¨¼ì € ì¶”ê°€í•´ì£¼ì„¸ìš”.');
      return;
    }
    const list = JSON.parse(localStorage.getItem(STORAGE_PLAYER)) || [];
    const filtered = list.filter(p => p.sport !== currentSport);
    const newList = filtered.concat(playerPositions.map(p => ({ sport: currentSport, name: p.name, x: p.x, y: p.y })));
    localStorage.setItem(STORAGE_PLAYER, JSON.stringify(newList));
    alert('ì„ ìˆ˜ ë°°ì¹˜ ì €ì¥ ì™„ë£Œ!');
    loadPlayers();
  }

  // ì„ ìˆ˜ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° (ì´ë¯¸ì§€ ìœ„ ì´ë¦„ê³¼ ì™„ì „ ë™ê¸°í™”)
  function loadPlayers() {
    const container = document.getElementById('player-list');
    container.innerHTML = '';
    const list = JSON.parse(localStorage.getItem(STORAGE_PLAYER)) || [];
    const filtered = list.filter(p => p.sport === currentSport);
    playerPositions = filtered.map(p => ({ ...p }));
    filtered.forEach((item, i) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.textContent = item.name;
      const btn = document.createElement('button');
      btn.className = 'delete-btn';
      btn.innerText = 'Ã—';
      btn.title = 'ì‚­ì œ';
      btn.onclick = () => {
        filtered.splice(i, 1);
        const original = JSON.parse(localStorage.getItem(STORAGE_PLAYER)) || [];
        const newList = original.filter(p => !(p.sport === currentSport && p.name === item.name && p.x === item.x && p.y === item.y));
        localStorage.setItem(STORAGE_PLAYER, JSON.stringify(newList));
        loadPlayers();
        changeDiagram();
      };
      div.appendChild(btn);
      container.appendChild(div);
    });
    changeDiagram();
  }

  function clearInputs() {
    if (currentInput) {
      currentInput.remove();
      currentInput = null;
      editingIndex = null; // ìˆ˜ì • ì¸ë±ìŠ¤ ì´ˆê¸°í™”
    }
    changeDiagram();
  }

  function changeDiagram() {
    const container = document.getElementById('diagram-container');
    const existingInput = container.querySelector('.name-input');
    const existingLabels = Array.from(container.querySelectorAll('.name-label'));

    // SVGë§Œ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±
    const existingSvg = container.querySelector('svg');
    if (existingSvg) existingSvg.remove();

    svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', '600');
    svg.setAttribute('height', '400');
    svg.style.border = '1px solid #333';
    svg.style.background = '#f0f0f0';
    container.appendChild(svg);

    function createRect(x, y, w, h, color, stroke = '#333', strokeWidth = 2) {
      const rect = document.createElementNS(svg.namespaceURI, 'rect');
      rect.setAttribute('x', x);
      rect.setAttribute('y', y);
      rect.setAttribute('width', w);
      rect.setAttribute('height', h);
      rect.setAttribute('fill', color);
      rect.setAttribute('stroke', stroke);
      rect.setAttribute('stroke-width', strokeWidth);
      return rect;
    }
    function createCircle(cx, cy, r, color, stroke = '#333', strokeWidth = 2, fillOpacity = 1) {
      const circle = document.createElementNS(svg.namespaceURI, 'circle');
      circle.setAttribute('cx', cx);
      circle.setAttribute('cy', cy);
      circle.setAttribute('r', r);
      circle.setAttribute('fill', color);
      circle.setAttribute('stroke', stroke);
      circle.setAttribute('stroke-width', strokeWidth);
      circle.setAttribute('fill-opacity', fillOpacity);
      return circle;
    }
    function createLine(x1, y1, x2, y2, color = '#333', strokeWidth = 2) {
      const line = document.createElementNS(svg.namespaceURI, 'line');
      line.setAttribute('x1', x1);
      line.setAttribute('y1', y1);
      line.setAttribute('x2', x2);
      line.setAttribute('y2', y2);
      line.setAttribute('stroke', color);
      line.setAttribute('stroke-width', strokeWidth);
      return line;
    }

    // ë°°ê²½ê³¼ ì½”íŠ¸ ê·¸ë¦¬ê¸°
    switch (currentSport) {
      case 'ë†êµ¬':
        svg.appendChild(createRect(50, 50, 500, 300, '#f39c12', '#b9770e', 3));
        svg.appendChild(createLine(300, 50, 300, 350, '#b9770e', 3));
        svg.appendChild(createCircle(300, 200, 50, 'none', '#b9770e', 3));
        svg.appendChild(createRect(50, 170, 20, 60, '#d35400', '#b9770e', 3));
        svg.appendChild(createRect(530, 170, 20, 60, '#d35400', '#b9770e', 3));
        break;
      case 'ë°°êµ¬':
        svg.appendChild(createRect(50, 50, 500, 300, '#4caf50', '#1c5980', 3));
        svg.appendChild(createLine(300, 50, 300, 350, '#2f2f2f', 3));
        svg.appendChild(createLine(200, 50, 200, 350, '#ffffff', 2));
        svg.appendChild(createLine(400, 50, 400, 350, '#ffffff', 2));
        svg.appendChild(createLine(50, 50, 550, 50, '#ffffff', 3));
        svg.appendChild(createLine(50, 350, 550, 350, '#ffffff', 3));
        svg.appendChild(createLine(50, 50, 50, 350, '#ffffff', 3));
        svg.appendChild(createLine(550, 50, 550, 350, '#ffffff', 3));
        break;
      case 'í‚¨ë³¼':
        svg.appendChild(createRect(50, 50, 500, 300, '#8a7862', '#2c3e50', 3));
        break;
      case 'ì¶•êµ¬':
        svg.appendChild(createRect(50, 50, 500, 300, '#27ae60', '#1e8449', 3));
        svg.appendChild(createLine(300, 50, 300, 350, '#dff0d8', 3));
        svg.appendChild(createRect(50, 125, 100, 150, '#2ecc71', '#27ae60', 3));
        svg.appendChild(createRect(450, 125, 100, 150, '#2ecc71', '#27ae60', 3));
        svg.appendChild(createRect(50, 170, 20, 60, '#145a32', '#1e8449', 3));
        svg.appendChild(createRect(530, 170, 20, 60, '#145a32', '#1e8449', 3));
        svg.appendChild(createCircle(300, 200, 50, 'none', '#dff0d8', 3));
        break;
    }

    // ê¸°ì¡´ ì´ë¦„ ë¼ë²¨ ì œê±°
    existingLabels.forEach(label => label.remove());

    // ì´ë¦„ ë¼ë²¨ ë‹¤ì‹œ ì¶”ê°€ ë° í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    playerPositions.forEach((pos, index) => {
      const label = document.createElement('div');
      label.className = 'name-label';
      label.textContent = pos.name;
      label.style.left = pos.x + 'px';
      label.style.top = pos.y + 'px';
      label.onclick = () => {
        openNameInput(pos.x, pos.y, index); // ìˆ˜ì • ëª¨ë“œë¡œ ì…ë ¥ì°½ ì—´ê¸°
      };
      container.appendChild(label);
    });

    // ê¸°ì¡´ ì…ë ¥ì°½ ë³µì›
    if (existingInput) {
      container.appendChild(existingInput);
    }

    // SVG í´ë¦­ ì´ë²¤íŠ¸
    svg.onclick = (e) => {
      const rect = svg.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      openNameInput(x, y); // ìƒˆ ì´ë¦„ ì¶”ê°€ ëª¨ë“œ
    };
  }

  function openNameInput(x, y, index = null) {
    clearInputs();
    const container = document.getElementById('diagram-container');
    currentInput = document.createElement('input');
    currentInput.type = 'text';
    currentInput.placeholder = 'ì´ë¦„ ì…ë ¥';
    currentInput.className = 'name-input';
    currentInput.style.left = x + 'px';
    currentInput.style.top = y + 'px';
    currentInput.style.position = 'absolute';
    editingIndex = index; // ìˆ˜ì • ì¤‘ì¸ ì¸ë±ìŠ¤ ì €ì¥

    // ìˆ˜ì • ëª¨ë“œë¼ë©´ ê¸°ì¡´ ì´ë¦„ ì±„ìš°ê¸°
    if (index !== null) {
      currentInput.value = playerPositions[index].name;
    }

    currentInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        saveInputName();
      }
      if (e.key === 'Escape') {
        clearInputs();
      }
    });
    currentInput.addEventListener('blur', () => {
      saveInputName();
    });

    container.appendChild(currentInput);
    currentInput.focus();
  }

  function saveInputName() {
    const val = currentInput.value.trim();
    if (val) {
      const x = parseFloat(currentInput.style.left);
      const y = parseFloat(currentInput.style.top);
      if (editingIndex !== null) {
        // ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸
        playerPositions[editingIndex] = { name: val, x, y };
      } else {
        // ì¶”ê°€ ëª¨ë“œ: ìƒˆ í•­ëª© ì¶”ê°€
        playerPositions.push({ name: val, x, y });
      }
    }
    clearInputs();
  }
</script>

</body>
</html>